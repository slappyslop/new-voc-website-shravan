{% extends "base.html" %}

{% block title %}Gearmaster{% endblock %}

{% block head_content %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vanilla-datatables@latest/dist/vanilla-dataTables.min.css" rel="stylesheet" type="text/css">
    <script src="https://cdn.jsdelivr.net/npm/vanilla-datatables@latest/dist/vanilla-dataTables.min.js" type="text/javascript"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            function initTable(table) {
                if (table && !table.dataset.dtInit) {
                    new DataTable(table, {
                        paging: true,
                        perPage: 25,
                        ordering: true,
                        searching: true,
                        labels: {
                            "perPage": "{select} rentals per page",
                            "noRows": "No rentals found",
                            "info": "Showing {start} to {end} of {rows} rentals"
                        }
                    });
                    table.dataset.dtInit = true;
                }
            }

            const tables = [
                document.getElementById("current-rentals-table"),
                document.getElementById("overdue-rentals-table"),
                document.getElementById("long-rentals-table"),
                document.getElementById("all-rentals-table")
            ]
            for (const table of tables) {
                initTable(table);
            }
        });
    </script>
{% endblock %}

{% block content %}
    <div class="container">
        <h2>Gearmaster Ten-Thousand</h2>

        <div class="d-flex justify-content-between align-items-center mb-2">
            <ul class="nav nav-tabs" id="gear-rental-tables" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link {% if not request.GET.q%}active{% endif %}" id="current" data-bs-toggle="tab" data-bs-target="#current-rentals">
                        Current Rentals
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="overdue" data-bs-toggle="tab" data-bs-target="#overdue-rentals">
                        Overdue Rentals
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="long" data-bs-toggle="tab" data-bs-target="#long-rentals">
                        Lost Rentals
                    </button>
                </li>
                <li class="nav-items" role="presentation">
                    <button class="nav-link {% if request.GET.q%}active{% endif %}" id="search" data-bs-toggle="tab" data-bs-target="#search-by-user">
                        Search for a Member
                    </button>
                </li>
            </ul>

            <a href="{% url 'create_rental' 'gear' %}" class="btn btn-primary">
                + New Rental
            </a>
        </div>

        <!-- Tab content -->
        <div class="tab-content mt-3">
            <div class="tab-pane fade {% if not request.GET.q %}show active{% endif %}" id="current-rentals" role="tabpanel" aria-labelledby="current-rentals">
                {% include "includes/rental_table.html" with rentals=rentals.current table_id="current_rentals_table" %}
            </div>
            <div class="tab-pane fade" id="overdue-rentals" role="tabpanel" aria-labelledby="overdue-rentals">
                {% include "includes/rental_table.html" with rentals=rentals.overdue table_id="overdue_rentals_table" %}
            </div>
            <div class="tab-pane fade" id="lost-rentals" role="tabpanels" aria-labelledby="lost-rentals">
                {% include "includes/rental_table.html" with rentals=rentals.lost table_id="lost_rentals_table" %}
            </div>
            <div class="tab-pane fade {% if request.GET.q %}show active{% endif %}" id="search-by-user" role="tabpanels" aria-labelledby="search-by-user">
                <form method="get" class="mb-3">
                    <input
                        type="text"
                        name="q"
                        class="form-control"
                        placeholder="Search for a member by name or email"
                        value="{{ request.GET.q }}"
                    >
                </form>
                {% include "includes/rental_table.html" with rentals=rentals.search table_id="search-table" %}
            </div>
         </div>
    </div>
{% endblock %}